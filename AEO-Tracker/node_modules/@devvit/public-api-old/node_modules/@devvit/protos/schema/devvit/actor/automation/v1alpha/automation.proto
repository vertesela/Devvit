syntax = "proto3";

package devvit.actor.automation.v1alpha;

import "devvit/actor/automation/v1alpha/step.proto";
import "devvit/actor/automation/v1alpha/trigger.proto";
import "devvit/reddit/comment.proto";
import "devvit/reddit/post.proto";
import "devvit/reddit/subreddit.proto";
import "devvit/reddit/user.proto";

option go_package = "github.snooguts.net/reddit/reddit-devplatform-monorepo/go-common/generated/protos/types/devvit/actor/automation";
option java_package = "com.reddit.devvit.actor.automation";

// The status of an automation
enum AutomationStatus {
  INSTALLED = 0; // Installed, but not actively executing on a trigger
  ENABLED = 1; // Installed and executing on a trigger
  DISABLED = 2; // Disabled by admins, does not run and cannot be re-enabled without admin approval. This is used if an automation is causing problems or is in violation of our policies.
}

// Whether or not automation is sharable
enum AutomationVisibility {
  PRIVATE = 0; // Only visible to mods of the installed subreddit
  PUBLIC = 1; // Published for sharing
}

// A series of actions to invoke upon a trigger
message Automation {
  string id = 1; // uuid of the automation, this will only be set when registered, when sharing this will be empty
  string name = 2; // Human readable name that will show up on the automation list
  string description = 3; // A quick description of the automation. This shows up in the automation list
  AutomationStatus status = 4; // If the automation is currently enabled or not. This will be empty during sharing
  AutomationVisibility visibility = 5; // A flag for tracking if the automation is sharable
  Trigger trigger = 6; // The trigger that kicks off this automation
  repeated StepDescription steps = 7; // A list of steps to execute in order
}

// The results on an automation run
message AutomationResult {
  string id = 1; // Id that came from the AutomationInvocation
  repeated StepReport steps = 2; // Reports from each actor that was invoked
}

// An invocation of an automation
message AutomationInvocation {
  string id = 1; // Uuid for this automation run
  Automation automation = 2; // Automation object
  oneof data { // The initial data coming from the trigger
    devvit.reddit.Comment comment = 3;
    devvit.reddit.Post post = 4;
    devvit.reddit.User user = 5;
  }
  devvit.reddit.Subreddit subreddit = 6;
}

// An actor type for the workflow engine itself.
service AutomationEngine {
  rpc Evaluate(AutomationInvocation) returns (AutomationResult); // Evaluates a workflow by invoking defined actor steps and gathering results
}
