import fetch from 'node-fetch';
import { GQL_QUERY_URL } from '../../util/config.js';
export async function gqlQuery(config) {
    const resp = await fetch(`${GQL_QUERY_URL}`, {
        method: 'POST',
        headers: {
            authorization: `Bearer ${config.accessToken}`,
            'content-type': 'application/json',
        },
        body: JSON.stringify({
            operationName: config.name,
            variables: config.variables,
            extensions: {
                persistedQuery: {
                    // This is the version of APQ, not of the query (see fed migration guide on the wiki)
                    version: 1,
                    sha256Hash: config.hash,
                },
            },
        }),
    });
    if (resp.ok)
        return (await resp.json());
    throw Error(`${config.name} HTTP error ${resp.status}: ${resp.statusText}`);
}
