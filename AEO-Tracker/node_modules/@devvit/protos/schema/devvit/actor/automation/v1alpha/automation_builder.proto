syntax = "proto3";

package devvit.actor.automation.v1alpha;

import "devvit/actor/automation/v1alpha/automation.proto";
import "devvit/actor/automation/v1alpha/trigger.proto";
import "devvit/actor/user_configurable/user_configurable.proto";
import "google/protobuf/empty.proto";

option go_package = "github.snooguts.net/reddit/reddit-devplatform-monorepo/go-common/generated/protos/types/devvit/actor/automation";
option java_outer_classname = "BuilderAutomation";
option java_package = "com.reddit.devvit.actor.automation";

// The type of step it is. Used to filter list request
enum StepType {
  ACTION = 0; // Action type step
  FILTER = 1; // Filter type step1
}

message GetTriggersRequest {}

message ListStepsRequest {
  string location = 1; // t5 id for subreddit
  TriggerType trigger_type = 2; // datatype the step operates on
  StepType step_type = 3; // type of step
}

message ListAutomationRequest {
  string location = 1; // t2_id for subreddit
}

message StepActor {
  string actor = 1;
  string label = 2;
  string description = 3;
  StepType type = 4;
}

message ActorList {
  repeated StepActor actors = 1;
}

message AutomationList {
  repeated Automation automations = 1;
}

message TriggerList {
  repeated Trigger triggers = 1;
}

message UpdateAutomationRequest {
  Automation automation = 1;
  string location = 2;
}

message GetStepFormRequest {
  string actor = 1;
}

// Service for providing data to Automation Builder UI element
service AutomationBuilder {
  // Looks up all registered Triggers from the database
  rpc GetTriggers(GetTriggersRequest) returns (TriggerList);
  // Find all installed Apps for the installation and return any actors that implement the trigger and step type
  rpc ListSteps(ListStepsRequest) returns (ActorList);
  // Get all automations for a given location (subreddit)
  rpc ListAutomations(ListAutomationRequest) returns (AutomationList);
  // Updates an automation. Will create a new automation if ID isn't set
  rpc UpdateAutomation(UpdateAutomationRequest) returns (google.protobuf.Empty);
  // Get form layout for step
  rpc GetStepForm(GetStepFormRequest) returns (devvit.actor.user_configurable.ConfigForm);
}
